<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4파르타</title>
    <!-- JQuary -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!--CSS 부트스트랩 땡겨오기 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <!-- CSS -->
    <link href="home.css" rel="stylesheet">

    <script type="module">
        // Firebase SDK 라이브러리 가져오기
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        import { collection, addDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        import { getDocs, setDoc, doc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        import { orderBy, query } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyDyD9wb7FVWS4lk-xe6jVjbLeIWZRNGoZY",
            authDomain: "p1teamhomepage.firebaseapp.com",
            projectId: "p1teamhomepage",
            storageBucket: "p1teamhomepage.appspot.com",
            messagingSenderId: "1064610336155",
            appId: "1:1064610336155:web:ef624e019c8ce49bae653e",
            measurementId: "G-5V9LYC2QW3"
        };
        // Firebase 인스턴스 초기화
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);



        $(document).ready(function () {
            /*추가버튼 팝업 열기*/
            $('.pop_btn, #write_btn, #search_btn, #update_btn').click(function (event) {
                event.preventDefault();
                var targetID = $(this).attr('href');
                $(targetID).fadeIn();
            });

            /*팝업 취소 버튼 팝업 닫기*/
            $('#cancel_wr, #cancel_search, #cancel_update').click(function () {
                var popupID = $(this).data('target');
                $(popupID).fadeOut();
            });
        });

        // 추가하기 버튼 누르면 Firebase에 저장
        $("#postingbtn").click(async function () {
            let image = $('#image').val();
            let surname = $('#surname').val();
            let firstname = $('#firstname').val();
            let mbti = $('#mbti').val();
            let comment = $('#comment').val();
            let email = $('#email').val();
            let blog = $('#blog').val();

            let timestamp = new Date(); /*마지막으로 저장한 시간*/
            const docId = surname + firstname; /*document이름을 성+이름*/

            if (image.length === 0) {
                alert('이미지URL을 입력해주세요.');
            } else if (surname.length === 0) {
                alert('성을 입력해주세요.');
            } else if (firstname.length === 0) {
                alert('이름을 입력해주세요.');
            } else if (mbti.length === 0) {
                alert('MBTI를 선택해주세요.');
            } else if (comment.length === 0) {
                alert('각오를 입력해주세요.');
            } else if (email.length === 0) {
                alert('이메일을 입력해주세요.');
            } else if (blog.length === 0) {
                alert('블로그주소를 입력해주세요.');
            } else {
                const docRef = doc(db, "members", docId); /*document 중복된 이름 없으면 생성*/
                let docData = {
                    'image': image,
                    'surname': surname,
                    'firstname': firstname,
                    'mbti': mbti,
                    'comment': comment,
                    'blog': blog,
                    'email': email,
                    'timestamp': timestamp
                };
                console.log(docData);
                await setDoc(docRef, docData); /*member에 저장*/
                alert('저장되었습니다.');
                window.location.reload(); /*새로고침*/
            }
        });


        // Firebase에 저장된 값들 카드로 띄우기
        //let docs = await getDocs(query(collection(db, "members"),orderBy("timestamp"))); 
        /**/
        let docs = await getDocs(query(collection(db, "members"),orderBy("timestamp","desc")));
        /*docs라는 변수에 members의 Document를 가져오는데, "timestamp"필드를 기준으로 최신것부터 정렬(orderBy)해서 query로 저장*/

        docs.forEach((doc) => {
            let row = doc.data();

            let image = row['image'];
            let surname = row['surname'];
            let firstname = row['firstname'];
            let mbti = row['mbti'];
            let email = row['email'];

            let new_card = `
            <div class="col">
                <div class="card h-100">
                    <a href=introMyself.html>
                        <div class="cardimg_wrap">
                            <img src="${image}" alt="..." class="card_img">
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">이름 : ${surname}${firstname}</h5>
                            <p class="card-text">MBTI : ${mbti}</p>
                            <p class="card-text">이메일 : ${email}</p>
                        </div>
                    </a>
                </div>
            </div>`;
            $('#card').append(new_card);
        });
    </script>


</head>

<body>
    <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start">
        <a href="/" class="d-flex align-items-center mb-2 mb-lg-0 text-white text-decoration-none">
            <svg class="bi me-2" width="40" height="32" role="img" aria-label="Bootstrap">
                <use xlink:href="#bootstrap"></use>
            </svg></a>
        <!-- 상단 바 -->
        <ul class="nav col-12 col-lg-auto me-lg-auto mb-2 justify-content-center mb-md-0">
            <li><a href="#" class="nav-link px-2 text-danger">saparta</a></li>
            <li><a href="#" class="nav-link px-2 text-white">홈</a></li>
        </ul>
    </div>

    <!-- 메인타이틀과 팀 소개글 -->
    <div class="main">
        <div class="container-fluid py-5">
            <h1 class="display-5 fw-bold">4파르타</h1>
            <p class="col-md-8 fs-4">병든 팀장을 둘러싸고 흉흉한 소문이 떠돈다. 어둠에 뒤덮인 4조, 기이한 역병에 신음하는 팀원. 정체 모를 악에 맞서 팀플을 구원할 희망은
                오직 OO뿐이다.</p>
        </div>
    </div>

    <!-- 팀원 카드 -->
    <div class="mycards">
        <div id="card" class="row row-cols-1 row-cols-md-3 g-4">
        </div>
    </div>

    <!-- 추가 수정 삭제 버튼  CSS로 못하겠다...-->
    <div class="memberbtn" style="float: right;">
        <button id="search_btn" href="#search_popup"><img
                src="https://cdn.icon-icons.com/icons2/2098/PNG/512/edit_icon_128873.png" width="50px"
                title="수정"></button>
        <button id="write_btn" href="#wr_popup"><img
                src="https://cdn.icon-icons.com/icons2/635/PNG/512/add-button_icon-icons.com_58943.png" width="50px"
                title="추가"></button>
        <button><img src="https://cdn.icon-icons.com/icons2/1337/PNG/512/deletebutton_87299.png" width="50px"
                title="삭제"></button>
    </div>

    <!-- 팝업 포스팅 박스-->
    <div id="wr_popup" class="popup" style="display: none;">
        <div class="wr-card">
            <div class="write-down">
                <label>
                    <h5>image : </h5>
                </label>
                <input type="text" id="image">
            </div>
            <div class="write-down">
                <label>
                    <h5>성 : </h5>
                </label>
                <input type="text" id="surname">
            </div>
            <div class="write-down">
                <label>
                    <h5>이름 : </h5>
                </label>
                <input type="text" id="firstname">
            </div>
            <div class="write-down">
                <label>
                    <h5>MBTI : </h5>
                </label>
                <select class="dropdown" id="mbti">
                    <option selected></option>
                    <option value="ISTJ">ISTJ</option>
                    <option value="ISFJ">ISFJ</option>
                    <option value="INFJ">INFJ</option>
                    <option value="INTJ">INTJ</option>
                    <option value="ISTP">ISTP</option>
                    <option value="ISFP">ISFP</option>
                    <option value="INFP">INFP</option>
                    <option value="INTP">INTP</option>
                    <option value="ESTP">ESTP</option>
                    <option value="ESFP">ESFP</option>
                    <option value="ENFP">ENFP</option>
                    <option value="ENTP">ENTP</option>
                    <option value="ESTJ">ESTJ</option>
                    <option value="ESFJ">ESFJ</option>
                    <option value="ENFJ">ENFJ</option>
                    <option value="ENTJ">ENTJ</option>
                </select>
            </div>
            <div class="write-down">
                <label>
                    <h5>각오 : </h5>
                </label>
                <textarea id="comment"></textarea>
            </div>
            <div class="write-down">
                <label>
                    <h5>이메일 : </h5>
                </label>
                <input type="text" id="email">
            </div>
            <div class="write-down">
                <label>
                    <h5>블로그 : </h5>
                </label>
                <input type="text" id="blog">
            </div>
            <div class="etcbtn" style="float: right;">
                <button id="postingbtn"><img
                        src="https://cdn.icon-icons.com/icons2/635/PNG/512/add-button_icon-icons.com_58943.png"
                        width="50px" title="등록"></button>
                <button id="cancel_wr" data-target="#wr_popup"><img
                        src="https://cdn.icon-icons.com/icons2/1337/PNG/512/deletebutton_87299.png" width="50px"
                        title="취소"></button>
            </div>
        </div>
    </div>

    <!-- 팝업 수정 박스1-->
    <div id="search_popup" class="popup" style="display: none;">
        <div class="search-card">
            <h1>수정할 팀원의 이름을 입력해주세요.</h1>
            <div class="search-name">
                <label>
                    <h5>이름 : </h5>
                </label>
                <input type="text" id="surname">
            </div>
            <div class="etcbtn" style="float: right;">
                <button id="update_btn" href="#update_popup"><img
                        src="https://cdn.icon-icons.com/icons2/635/PNG/512/add-button_icon-icons.com_58943.png"
                        width="50px" title="검색"></button>
                <button id="cancel_search" data-target="#search_popup"><img
                        src="https://cdn.icon-icons.com/icons2/1337/PNG/512/deletebutton_87299.png" width="50px"
                        title="취소"></button>
            </div>
        </div>
    </div>

    <!-- 팝업 수정update 박스2-->
    <div id="update_popup" class="popup" style="display: none;">
        <div class="wr-card">
            <div class="write-down">
                <label>
                    <h5>image : </h5>
                </label>
                <input type="text" id="serverimage">
            </div>
            <div class="write-down">
                <label>
                    <h5>성 : </h5>
                </label>
                <input type="text" id="serversurname">
            </div>
            <div class="write-down">
                <label>
                    <h5>이름 : </h5>
                </label>
                <input type="text" id="serverfirstname">
            </div>
            <div class="write-down">
                <label>
                    <h5>MBTI : </h5>
                </label>
                <select class="dropdown" id="servermbti">
                    <option selected></option>
                    <option value="ISTJ">ISTJ</option>
                    <option value="ISFJ">ISFJ</option>
                    <option value="INFJ">INFJ</option>
                    <option value="INTJ">INTJ</option>
                    <option value="ISTP">ISTP</option>
                    <option value="ISFP">ISFP</option>
                    <option value="INFP">INFP</option>
                    <option value="INTP">INTP</option>
                    <option value="ESTP">ESTP</option>
                    <option value="ESFP">ESFP</option>
                    <option value="ENFP">ENFP</option>
                    <option value="ENTP">ENTP</option>
                    <option value="ESTJ">ESTJ</option>
                    <option value="ESFJ">ESFJ</option>
                    <option value="ENFJ">ENFJ</option>
                    <option value="ENTJ">ENTJ</option>
                </select>
            </div>
            <div class="write-down">
                <label>
                    <h5>각오 : </h5>
                </label>
                <textarea id="servercomment"></textarea>
            </div>
            <div class="write-down">
                <label>
                    <h5>이메일 : </h5>
                </label>
                <input type="text" id="serveremail">
            </div>
            <div class="write-down">
                <label>
                    <h5>블로그 : </h5>
                </label>
                <input type="text" id="serverblog">
            </div>
            <div class="etcbtn" style="float: right;">
                <button id="update_btn2"><img
                        src="https://cdn.icon-icons.com/icons2/635/PNG/512/add-button_icon-icons.com_58943.png"
                        width="50px" title="수정"></button>
                <button id="cancel_update" data-target="#update_popup"><img
                        src="https://cdn.icon-icons.com/icons2/1337/PNG/512/deletebutton_87299.png" width="50px"
                        title="취소"></button>
            </div>
        </div>
    </div>

</body>

</html>