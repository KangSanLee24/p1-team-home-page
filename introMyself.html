<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4parta - 팀 소개</title>
    <!-- JQuary -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!--CSS 부트스트랩 땡겨오기 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">;
    <!-- CSS -->
    <link href="introMyself.css" rel="stylesheet">

    <script type="module">
        // Firebase SDK 라이브러리 가져오기
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import {
            getFirestore,
            collection,
            getDocs,
            setDoc,
            doc,
            addDoc,
            orderBy,
            query,
<<<<<<< HEAD
            deleteDoc, // 여기에 deleteDoc도 포함시킴
            getDoc,
            updateDoc // updateDoc도 추가함
=======
            deleteDoc,
            getDoc
>>>>>>> 5e18e2fb2fd990d01bfccaeaa6b277943d4f945c
        } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyDyD9wb7FVWS4lk-xe6jVjbLeIWZRNGoZY",
            authDomain: "p1teamhomepage.firebaseapp.com",
            projectId: "p1teamhomepage",
            storageBucket: "p1teamhomepage.appspot.com",
            messagingSenderId: "1064610336155",
            appId: "1:1064610336155:web:ef624e019c8ce49bae653e",
            measurementId: "G-5V9LYC2QW3"
        };
        // Firebase 인스턴스 초기화
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        /*키면 당연히 되야되는 것들*/
        $(document).ready(function () {
            /*수정버튼 팝업 열기*/
            $('#edit_btn').click(function (event) {
                event.preventDefault();
                var targetID = $(this).attr('href');
                $(targetID).fadeIn();
            });

            /*팝업 취소 버튼 팝업 닫기*/
            $('.cancel_btn').click(function () {
                $('#wr_popup').fadeOut();
            });
        });
        /*삭제버튼 누를시 삭제*/
        $('.delete_btn').click(async function () {
            const urlParams = new URLSearchParams(window.location.search); // ???? window location search? 
            const memberId = urlParams.get('id');  // URL에서 ID값 가져옴
            try {
                await deleteDoc(doc(db, "members", memberId));
                alert("삭제되었습니다.");
                window.location.href = 'home.html';
            } catch (error) {
                console.error("문서 삭제 중 오류 발생:", error);
                alert("문서 삭제에 실패했습니다.");
            }
        });
        /*수정 팝업에 수정하기 버튼 누르면 update됨 */
        $('#savebtn').click(async function () {
            let image = $('#image').val();
            let surname = $('#surname').val();
            let firstname = $('#firstname').val();
            let mbti = $('#mbti').val();
            let comment = $('#comment').val();
            let email = $('#email').val();
            let blog = $('#blog').val();

            const urlParams = new URLSearchParams(window.location.search); // ???? window location search? 
            const memberId = urlParams.get('id');  // URL에서 ID값 가져옴
            const docRoute = doc(db, "members", memberId); /*ref or route? 참조 가져옴*/
            const docFields = await getDoc(docRoute); /* 변수 docFields에 docRoute 참조를 따라갔을 때 나오는 Document의 정보를 넣음.*/
            const docFieldsTimestamp = docFields.data();
            let timestamp = docFieldsTimestamp; // 처음 저장한 시간으로 유지

            const docId = surname + firstname; /*document이름을 성+이름*/
            
            if (image.length === 0) {
                alert('이미지URL을 입력해주세요.');
            } else if (surname.length === 0) {
                alert('성을 입력해주세요.');
            } else if (firstname.length === 0) {
                alert('이름을 입력해주세요.');
            } else if (mbti.length === 0) {
                alert('MBTI를 선택해주세요.');
            } else if (comment.length === 0) {
                alert('각오를 입력해주세요.');
            } else if (email.length === 0) {
                alert('이메일을 입력해주세요.');
            } else if (blog.length === 0) {
                alert('블로그주소를 입력해주세요.');
            } else {
                const docRef = doc(db, "members", docId); /*document 중복된 이름 없으면 생성*/
                let docData = {
                    'image': image,
                    'surname': surname,
                    'firstname': firstname,
                    'mbti': mbti,
                    'comment': comment,
                    'blog': blog,
                    'email': email,
                    'timestamp': timestamp
                };
                console.log(docData);
                await updateDoc(docRef, docData); /*콜렉션 members에 update*/
                alert('수정한 내용이 저장되었습니다.');
                window.location.reload(); /*새로고침*/
            }
        });


        /*Document 이름 받으면 빈칸에 데이터를 채워줌*/
        async function fetchMemberDetails(memberId) {
            /* 'members' 컬렉션에서 memberId에 해당하는 문서를 참조합니다.*/
            const docRoute = doc(db, "members", memberId); /*ref or route? 참조 가져옴*/
            const docFields = await getDoc(docRoute); /* 변수 docFields에 docRoute 참조를 따라갔을 때 나오는 Document의 정보를 넣음.*/

            /*문서가 존재하냐*/
            if (docFields.exists()) {
                const memberData = docFields.data(); /*변수 memberData에 Document의 정보들을 넣어줌*/
                /* 변수 memberDate에 docFields다 들어왔는지 체크 한번*/
                console.log(memberData);

                /* 각 필드 값을 변수로 저장*/
                const image = memberData.image;
                const surname = memberData.surname;
                const firstname = memberData.firstname;
                const mbti = memberData.mbti;
                const email = memberData.email;
                const blog = memberData.blog;
                const comment = memberData.comment;
                /*console띄워서 변수에 정보 잘 들어갔나 체크 한번 */
                console.log(`Image URL: ${image}`);
                console.log(`Surname: ${surname}`);
                console.log(`Firstname: ${firstname}`);
                console.log(`MBTI: ${mbti}`);
                console.log(`Email: ${email}`);
                console.log(`Blog URL: ${blog}`);
                console.log(`Comment: ${comment}`);
                $("#memberimage").attr("src", image);
                $('#memberfullname').text(surname + firstname);
                $('#membermbti').text(mbti);
                $('#memberemail').text(email);
                $('#memberblog').text(blog);
                $('#membercomment').text(comment);
                /* */
                document.getElementById("image").value = image;
                document.getElementById("surname").value = surname;
                document.getElementById("firstname").value = firstname;
                document.getElementById("mbti").value = mbti;
                document.getElementById("email").value = email;
                document.getElementById("blog").value = blog;
                document.getElementById("comment").value = comment;
            } else { /*존재안할때 console에 남김*/
                console.log("No such member found");
                //로그를 남기는게 아니라 alert(페이지를 찾을 수 없다) 뭐 이런거 나오면서 HOME으로 돌아가는 기능?
            }
        }

        // 페이지 로드 시 실행
        window.onload = () => {
            const urlParams = new URLSearchParams(window.location.search); // ???? window location search? 
            const memberId = urlParams.get('id');  // URL에서 ID값 가져옴
            fetchMemberDetails(memberId);  // 멤버정보 가져오는 함수 실행
        }

    </script>
</head>

<body>
    <div class="wrap">
        <h1>나를 소개합니다</h1>
        <div class="btn-icon">
            <a href="#wr_popup" id="edit_btn"><button><img
                        src="https://cdn.icon-icons.com/icons2/2098/PNG/512/edit_icon_128873.png" width="50px"
                        title="수정"></button></a>
            <button class="delete_btn"><img src="https://cdn-icons-png.flaticon.com/512/70/70287.png" width="50px"
                    title="삭제"></button>
        </div>
        <div class="mini-wrap">
            <div class="image">
                <img id="memberimage"
                    src="data:image/png;base64,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"
                    width="500px">
            </div>
            <div class="member-intro">
                <div class="form-1">
                    <label>이름 : </label>
                    <span id="memberfullname"></span>
                    <label>MBTI : </label>
                    <span id="membermbti"></span>
                </div>
                <div class="form-1">
                    <label>이메일 : </label>
                    <span id="memberemail"></span>
                    <label>블로그 : </label>
                    <span id="memberblog"></span>
                </div>
                <div class="form-2">
                    <label>각오</label>
                    <span id="membercomment"></span>
                </div>
            </div>
        </div>
    </div>

    <!-- 팝업 포스팅 박스-->
    <div id="wr_popup" class="popup" style="display: none;">
        <div class="wr-card">
            <div class="write-down">
                <label>
                    <h5>image : </h5>
                </label>
                <input type="text" id="image">
            </div>
            <div class="write-down">
                <label>
                    <h5>성 : </h5>
                </label>
                <input type="text" id="surname">
            </div>
            <div class="write-down">
                <label>
                    <h5>이름 : </h5>
                </label>
                <input type="text" id="firstname">
            </div>
            <div class="write-down">
                <label>
                    <h5>MBTI : </h5>
                </label>
                <select class="dropdown" id="mbti">
                    <option selected></option>
                    <option value="ISTJ">ISTJ</option>
                    <option value="ISFJ">ISFJ</option>
                    <option value="INFJ">INFJ</option>
                    <option value="INTJ">INTJ</option>
                    <option value="ISTP">ISTP</option>
                    <option value="ISFP">ISFP</option>
                    <option value="INFP">INFP</option>
                    <option value="INTP">INTP</option>
                    <option value="ESTP">ESTP</option>
                    <option value="ESFP">ESFP</option>
                    <option value="ENFP">ENFP</option>
                    <option value="ENTP">ENTP</option>
                    <option value="ESTJ">ESTJ</option>
                    <option value="ESFJ">ESFJ</option>
                    <option value="ENFJ">ENFJ</option>
                    <option value="ENTJ">ENTJ</option>
                </select>
            </div>
            <div class="write-down">
                <label>
                    <h5>각오 : </h5>
                </label>
                <textarea id="comment"></textarea>
            </div>
            <div class="write-down">
                <label>
                    <h5>이메일 : </h5>
                </label>
                <input type="text" id="email">
            </div>
            <div class="write-down">
                <label>
                    <h5>블로그 : </h5>
                </label>
                <input type="text" id="blog">
            </div>
            <div class="etcbtn" style="float: right;">
                <button id="savebtn"><img
                        src="https://cdn.icon-icons.com/icons2/635/PNG/512/add-button_icon-icons.com_58943.png"
                        width="50px" title="수정하기"></button>
                <button class="cancel_btn"><img
                        src="https://cdn.icon-icons.com/icons2/1337/PNG/512/deletebutton_87299.png" width="50px"
                        title="취소"></button>
            </div>
        </div>
    </div>
</body>

</html>